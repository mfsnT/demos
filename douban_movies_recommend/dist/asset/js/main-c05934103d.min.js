!function(t){function e(n){if(i[n])return i[n].exports;var s=i[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,e),s.l=!0,s.exports}var i={};e.m=t,e.c=i,e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=1)}([function(t,e){t.exports=jQuery},function(t,e,i){var n=i(0),s=i(2),r=i(3);n(function(){!function(){var t=n("section"),e=n(".top"),i=n(".north-america"),a=n(".search"),c=n(".btn-group"),o=c.children(),u=i.children(".movie-list"),l=new r(e.children(".movie-list")),d=new r(u),h=new r(a.children(".movie-list"));new s(e.children(".update-icon"),e,!0,function(t){l.getMovies("top250")}),new s(a.children(".update-icon"),a,!1,function(t){h.getMovies("search")}),c.on("click","li",function(){var e=n(this),s=e.index(),r=!u.html();e.hasClass("active-btn")||(1===s&&r&&(i.children(".update-icon").addClass("rotate"),d.getMovies("us_box",function(t){t.hide()})),t.eq(s).addClass("current-section").siblings().removeClass("current-section"),o.eq(s).addClass("active-btn").siblings().removeClass("active-btn"))})}()})},function(t,e,i){function n(t,e,i,n){this.$target=t,this.$target_ct=e,this.handle=n,this.timer=null,this.shouldTriggerFirstTime=i,this.bind()}var s=i(0);n.prototype={bind:function(){function t(t,e){return t.offset().top<e.height()}var e=this.$target,i=this;this.$target_ct.on("scroll",function(){clearTimeout(i.timer),t(e,s(this))&&(setTimeout(function(){e.addClass("rotate")},20),i.timer=setTimeout(function(){i.handle(e)},1e3))}),i.shouldTriggerFirstTime&&e.trigger("scroll")}},t.exports=n},function(t,e,i){function n(t){if(this.$ct=t,this.start=0,this.$icon=t.siblings(".update-icon"),this.canGetMovies=!0,t.parent().hasClass("search")){var e=this.$search_bar=t.siblings(".search-bar");this.$input=e.children(".input"),this.$btn=e.children(".search-btn"),this.current_query_str="",this.bind()}}var s=i(0);n.prototype={bind:function(){var t=this.$input,e=this.$btn,i=this.$icon,n=this.$ct,s=this.$search_bar,r=this;e.on("click",function(){if(r.canGetMovies){var e=t.val();if(/^\s*$/.test(e))return s.addClass("showTips"),void setTimeout(function(){s.removeClass("showTips")},1200);r.current_query_str!==e&&(r.current_query_str=e,n.empty(),r.start=0),i.show().addClass("rotate"),r.getMovies("search")}})},getMovies:function(t,e){function i(t,e){var i=document.createDocumentFragment(),n='<li class="movie-list-item"><a><div class="cover"><img></div><div class="movie-message"><h2></h2><p><span class="score"></span>分 / <span class="collect"></span>收藏</p><p><span class="year"></span> / <span class="type"></span></p><p>导演：<span class="director"></span></p><p>主演：<span class="actor"></span></p></div></a></li>';"豆瓣电影北美票房榜"===e.title?e.subjects.forEach(function(t){var e="",r="",a=s(n);t.subject.directors.forEach(function(e,i){i===t.subject.directors.length-1?r+=e.name:r+=e.name+"、"}),t.subject.casts.forEach(function(i,n){n===t.subject.casts.length-1?e+=i.name:e+=i.name+"、"}),a.find("a")[0].href=t.subject.alt,a.find(".cover img")[0].src=t.subject.images.medium,a.find("h2").text(t.subject.title),a.find(".score").text(t.subject.rating.average),a.find(".collect").text(t.subject.collect_count),a.find(".year").text(t.subject.year),a.find(".type").text(t.subject.genres.join(" / ")),a.find(".director").text(r),a.find(".actor").text(e),i.appendChild(a[0])}):e.subjects.forEach(function(t){var e="",r="",a=s(n);t.directors.forEach(function(e,i){i===t.directors.length-1?r+=e.name:r+=e.name+"、"}),t.casts.forEach(function(i,n){n===t.casts.length-1?e+=i.name:e+=i.name+"、"}),a.find("a")[0].href=t.alt,a.find("h2").text(t.title),a.find(".cover img")[0].src=t.images.medium,a.find(".score").text(t.rating.average),a.find(".collect").text(t.collect_count),a.find(".year").text(t.year),a.find(".type").text(t.genres.join(" / ")),a.find(".director").text(r),a.find(".actor").text(e),i.appendChild(a[0])}),t.append(i)}if(this.canGetMovies){this.canGetMovies=!1;var n=this,r=this.$icon,a={dataType:"jsonp",data:{start:n.start}};"top250"===t?a.url="https://api.douban.com/v2/movie/top250":"us_box"===t?a.url="https://api.douban.com/v2/movie/us_box":"search"===t&&(a.url="https://api.douban.com/v2/movie/search",a.data.q=this.current_query_str),s.ajax(a).done(function(t){i(n.$ct,t),r.removeClass("rotate"),e&&e(r),n.start+=20,n.canGetMovies=!0}).fail(function(){n.$ct.append('<li style="text-align:center;margin-top:1rem;">获取数据失败，请检查网络</li>'),r.removeClass("rotate")})}}},t.exports=n}]);